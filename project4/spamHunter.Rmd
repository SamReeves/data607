---
title: "Spam Hunter"
author: "Sam Reeves"
date: "4/29/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

### The Project

We have been tasked with creating a model to correctly separate spam emails from ham emails.  Apparently, ham is industry jargon for the emails you actually want to receive.

In order to collect some extra credit points, I'll be using the relatively new tidymodels package to build my model.

### The Data

SpamAssassin is an open-source project from Apache meant to enable system administrators to implement text analysis, Bayesian filtering, and other methods to help stamp out the global spamdemic.

Version 3.4.6 was realeased on April 12 of this year, and it is the last update before the release of 4.0.  I found it helpful to read through the source code.  You guessed it, this release comes with an Apache v2.0 license:

https://downloads.apache.org//spamassassin/source/Mail-SpamAssassin-3.4.6.tar.gz

We will be loading some old datasets and not using the newest software.  They can be found here:

https://spamassassin.apache.org/old/publiccorpus/

```{r, message=FALSE}
library(data.table)
library(tidyverse)
library(magrittr)

spam_dir <- "/home/s/code/data607/project4/spam"
ham_dir <- "/home/s/code/data607/project4/ham"

collect <- function(directory, spam = 1) {
  df <- list.files(path = directory) %>%
  as.data.frame() %>%
  set_colnames("file") %>%
  mutate(text = lapply(list.files(path = directory,
                                  full.names = TRUE),
                       read_lines)) %>%
  unnest(c(text)) %>%
  mutate(type = spam) %>%
  group_by(file) %>%
  mutate(text = paste(text, collapse = " ")) %>%
  ungroup() %>%
  distinct()
  
  return(df)
}

setwd(spam_dir)
spam_list <- unzip("spam.zip", list = TRUE)
unzip("spam.zip")
spam <- collect(spam_dir, spam = 1)
do.call(file.remove, spam_list)

setwd(ham_dir)
ham_list <- unzip("ham.zip", list = TRUE)
unzip("ham.zip")
ham <- collect(ham_dir, spam = 0)
do.call(file.remove, ham_list)
```


### The Model

### Binary Categorization

### Conclusions